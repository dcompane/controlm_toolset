## Set up a new agentless host

| Step                                     | Manually (Web GUI, editor, or command)                                                                                                                                                                                                                                                                                                | CTM CLI                                                                                                                                                                                                                                                                                                                                                                                             |
| ---------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Create SSH Keys                          | [Creating an SSH Key](https://documents.bmc.com/supportu/9.0.22/en-US/Documentation/Agentless_Hosts.htm#CreatinganSSHKey) <br />Config->Agents->Manage-> SSH keys-> (+)<br />Download the SSH public key when asked   Or use the [ctmkeygen](https://documents.bmc.com/supportu/9.0.22/en-US/Documentation/Utilities/ctmkeygen.htm) utility | [SSH Key Configuration](https://documents.bmc.com/supportu/API/Monthly/en-US/Documentation/API_Services_ConfigService_SSHKey.htm) <br />Create the SSH Key<br />     ctm config server:sshkey::add `<server> <Key>` `<PK passphrase>` `<key type> <key algo> <key length>`<br />RSA 3072 <br /> Get the public Key <br />    ctm config server:sshkey:getSshKey::get dc01 dcompane2 empass |
| Prepare the agentless host user account  | Add the public key to the ~/.ssh/authorized\_keys file <br />Ensure the directory and file permissions are 600 (rw-------)                                                                                                                                                                                                            | N/A  (if you later define the RunAsUser as a password AND key,<br />you can run a job to add the SSH key to the authorized\_keys file and remove that ability after the onboarding is complete).                                                                                                                                                                                                    |
| Enable the Java Remote Host on the Hosts | [Java-Based Agentless Host on UNIX](https://documents.bmc.com/supportu/9.0.22/en-US/Documentation/Agentless_Hosts.htm#JavaBasedAgentlessHostonUNIX) <br />Manually modify the ~/ctm/data/RHCONF.dat to ensure that JAVA\_RH Y                                                                                                            | ctm config server:agent:param::set `<server> <Agent>`JAVA\_RH Y                                                                                                                                                                                                                                                                                                                                   |
| Enable the upload of utilities           | [Uploading All Agent Utilities to an Agentless Host](https://documents.bmc.com/supportu/9.0.22/en-US/Documentation/Agentless_Hosts.htm#UploadingAllAgentUtilitiestoanAgentlessHost) <br />Manually modify the ~/ctm/data/CONFIG.dat to ensure <br />that UPLOAD\_REMOTE\_UTILS Y                                                         | ctm config server:agent:param::set `<server> <Agent>`dc01 dc03-ctmagent2UPLOAD\_REMOTE\_UTILS Y                                                                                                                                                                                                                                                                                                   |
| Restart the agent                        | Via the Web UI<br />Or <br />shut-ag;start-ag                                                                                                                                                                                                                                                                                         | ctm config item::recycle CTMS:Agent:`<server><Agent>`                                                                                                                                                                                                                                                                                                                                             |
| Define the remote host                   | [Creating an Agentless Host](https://documents.bmc.com/supportu/9.0.22/en-US/Documentation/Agentless_Hosts.htm#CreatinganAgentlessHost) <br />Config->Agents-> (+) Add Agent->Agentless host <br /> Or<br /> use the [ctmhostmap](https://documents.bmc.com/supportu/9.0.22/en-US/Documentation/Utilities/ctmhostmap.htm) utility           | [Agentless Host Configuration](https://documents.bmc.com/supportu/API/Monthly/en-US/Documentation/API_Services_ConfigService_Agentless_Host.htm) <br />ctm config server:agentlesshost::add `<server> <Agent>`<br />Agent may go in Discovering state for a while until it becomes unavailable.                                                                                                      |
| Authorize the host                       | [Authorizing an SSH Known Host](https://documents.bmc.com/supportu/9.0.22/en-US/Documentation/Agentless_Hosts.htm#AuthorizinganSSHKnownHost) <br />Config->Agents Select the agent, and use the Authorize SSH Known Host option                                                                                                          | ctm config server:agentlesshost::authorize `<server> <hostname>`<br />ctm config server:agentlesshost::authorize dc01 rpie                                                                                                                                                                                                                                                                        |
| Create the RunAsUser                     | [Adding a Run as User](https://documents.bmc.com/supportu/9.0.22/en-US/Documentation/Run_as_User_Management.htm) <br />Config->Agents-> Manage -> Run as Users                                                                                                                                                                           | [Run as User Configuration](https://documents.bmc.com/supportu/API/Monthly/en-US/Documentation/API_Services_ConfigService_RunAsUser.htm)<br />ctm config server:runasuser::add `<server> -f <file.json>`<br />ctm config server:runasuser::add dc01 -f add\_runas.json<br /><br />``{  "agent": "dc03-ctmag4",  "user": "ctmag4",  "key": {    "keyname": "ctmag4"  }}``                             |
| Validate the RunAsUSer                   | [Adding a Run as User](https://documents.bmc.com/supportu/9.0.22/en-US/Documentation/Run_as_User_Management.htm) <br />Config->Agents-> Manage -> Run as Users (use the test icon)                                                                                                                                                       | ctm config server:runasuser::test `<server> <hostname> <user> -f <file.json> <br>`ctm config server:runasuser::test dc01 rpie dcompane1 -f test\_runas.json `<br>`  ``{  "key":  {  "keyname": "dcompane2",  "passphrase": "empass"  } }``                                                                                                                                                      |

### Additional notes about keys

When setting up the user, do not forget to add the public key that COntrol-M offers to the authorized_keys file

The file will be found in the .ssh directory for the user where the jobs will execute.

```bash
mkdir ~/.ssh
chmod 700 ~/.ssh
cd ~/.ssh
# note the >> to avoid ovewriting the file if there are other keys already loaded
#    the file will be created if it did not exist
# paste the public key instead of the text copy the key
echo "copy the key" >> ~/.ssh/authorized_files
chmod 600 ~/.ssh/authorized_files
```

### Interesting reading

[RSA Key Sizes, ECDSA, Curve Choices: What’s Safe In 2025 - Newsoftwares.net Blog](https://www.newsoftwares.net/blog/rsa-key-sizes-ecdsa-curve-choices-whats-safe-in-2025/)
